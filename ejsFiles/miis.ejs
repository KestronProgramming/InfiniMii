<!DOCTYPE html>
<html>
    <head>
        <title>
            <%= title %>
        </title>
        <link href="./global.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>

    <body>
        <%- include('globalStyle') %>
        <%- include('header') %>
        <%- include('accountDisplay') %>
        <div class="content">
            <%- include('sidebar') %>
            <div class="main-content">
                <div id="browse-miis">
                    <% for(var i=0;i<displayedMiis.length;i++){ %>
                        <div class="mii-card" style="--favorite-color: <%= decodeColor(displayedMiis[i].general?.favoriteColor) || decodeColor(0) %>;" id="<%= displayedMiis[i].id %>">
                            <a href=<%='/mii/' +displayedMiis[i].id %>><img src="miiImgs/<%= displayedMiis[i].id %>.png"></a>
                            <div class="flex">
                                <div>
                                    <h3><%= displayedMiis[i].meta.name %></h3>
                                    <a href=<%="/user/" +encodeURIComponent(displayedMiis[i].uploader) %>><%=displayedMiis[i].uploader %></a>
                                    <p><%= displayedMiis[i].desc.length>75?displayedMiis[i].desc.slice(0,73)+"...":displayedMiis[i].desc %></p>
                                </div>
                            </div>
                        </div>
                    <% } %>
                </div>
                
                <!-- Pagination Controls -->
                <% if (pagination && pagination.totalPages > 1) { %>
                    <div class="pagination">
                        <% if (pagination.currentPage > 1) { %>
                            <a href="?page=<%= pagination.currentPage - 1 %><%= query.q ? '&q=' + encodeURIComponent(query.q) : '' %><%= query.category ? '&category=' + encodeURIComponent(query.category) : '' %><%= pagination.seed ? '&seed=' + pagination.seed : '' %>" class="pagination-btn">← Previous</a>
                        <% } %>
                        
                        <span class="pagination-info">
                            Page <%= pagination.currentPage %> of <%= pagination.totalPages %> 
                            (<%= pagination.total %> Miis)
                        </span>
                        
                        <% if (pagination.currentPage < pagination.totalPages) { %>
                            <a href="?page=<%= pagination.currentPage + 1 %><%= query.q ? '&q=' + encodeURIComponent(query.q) : '' %><%= query.category ? '&category=' + encodeURIComponent(query.category) : '' %><%= pagination.seed ? '&seed=' + pagination.seed : '' %>" class="pagination-btn">Next →</a>
                        <% } %>
                    </div>
                <% } %>
            </div>
            <%- include('featuredMiis') %>
        </div>
        <%- include('footer') %>
        <script src="/global.js"></script>
    </body>
</html>